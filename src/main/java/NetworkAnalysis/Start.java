package NetworkAnalysis;

import entites.Tweet;
import it.stilo.g.structures.WeightedDirectedGraph;
import org.apache.lucene.queryparser.classic.ParseException;

import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Set;

public class Start {
    public static void main(String[] args) throws IOException, ParseException {
        System.out.println("Starting...");
        System.out.println("Getting tweets...");
        //2.1
        FindTweets ft = new FindTweets();
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //metodo per trovare, salvare e resituire tweet (creare dataset, eseguire una volta sola quando dataset Ã¨ vuoto)
        //ArrayList<Tweet> tweets= ft.find();

        //metodo per recuperare e restiutire tweet (dataset gia creato, eseguire piu volte dopo ft.find)
        ArrayList<Tweet> tweets= ft.getTweets();
////////////////////////////////////////////////////////////////////////////////////////////////////////////

        System.out.println("Done, nice");
        System.out.println("Let make some graph :D");

        System.out.println("Mentions Graph first...");

        //2.2b

        MentionsGraph  graph1 = new MentionsGraph();
        for (Tweet t : tweets) {
            long from = Long.parseLong(t.User_ID);
            if (graph1.adj.keySet().size() >= 10000) {      //limit first 10k users
                for (String mention : t.Mentions) {
                    long to = Long.parseLong(mention);
                    if (graph1.adj.keySet().contains(from) && graph1.adj.keySet().contains(to))
                        graph1.addEdge(from, to);
                }
            } else {
                for (String mention : t.Mentions) {
                    long to = Long.parseLong(mention);
                    graph1.addEdge(from, to);
                }
            }
        }
        // tagliare i bordi meno utili
            MentionsGraph graph = new MentionsGraph();
            for (long key : graph1.adj.keySet()) {
                if(!graph1.adj.get(key).isEmpty()) graph.adj.put(key,new ArrayList<>());
            }
            for (long key : graph.adj.keySet()){
                ArrayList<ArrayList<Long>> arcs = new ArrayList<>();
                for (ArrayList<Long> arc :graph1.adj.get(key)){

                    if (graph.adj.containsKey(arc.get(1))){
                        arcs.add(arc);
                    }
                }
                graph.addAllEdges(arcs);
            }

        /*
        graph1.addEdge(1, 2);
        graph1.addEdge(2, 3);
        graph1.addEdge(1, 3);
        graph1.addEdge(3, 1);
        graph1.addEdge(2, 1);
        graph1.addEdge(1, 3);
        graph1.addEdge(1, 2);
        graph1.addEdge(1,4);
        graph1.addEdge(6,5);
        graph1.addEdge(7,6);
        TimeGraph  graph2 = new TimeGraph();
        graph2.addEdge(1, 2);
        graph2.addEdge(2, 3);
        graph2.addEdge(1, 3);
        graph2.addEdge(3, 1);
        graph2.addEdge(2, 1);
        graph2.addEdge(1, 3);
        graph2.addEdge(1, 2);
        graph2.addEdge(4,5);
*/
        System.out.println("Done!");
        //System.out.println( graph2);
        //ArrayList<Long> keys = (ArrayList<Long>) graph1.adj.keySet();
       // System.out.println(graph1.largestConnectedComponents());
        MentionsGraph graph3 = new MentionsGraph();
        System.out.println("Now largest Connected Component...");
        graph3.addAllEdges(graph.largestConnectedComponents());

        System.out.println( graph3);
        System.out.println(graph3.adj.size());

        Rank rank =new Rank();
        System.out.println(rank.HITS(graph3.adj));

        System.out.println(rank.KP_NEG(graph3.adj));    //ci mette tantissimo tempo +20min per 511utenti, per 327(archi tagliati prima) 3min
        // result of KP_NEG
        //{453473029=76, 2659372678=231, 286432534=98, 23185764=466, 4906451067=126, 923719833077846021=42, 755135678422327296=406, 43878033=108, 820452522494226433=139, 450896622=82, 19397942=91, 1056850669=22, 22146373=6, 2790295109=5, 704282873231237121=136, 730526974003838976=466, 17836302=77, 11347122=98, 1076293903723233280=126, 1194962714=126, 1253665449008562178=102, 30761456=126, 974248363544731649=73, 21707108=466, 594508639=6, 14050532=37, 522487569=4, 3131144855=95, 1417251=76, 87679233=114, 406842374=111, 374112886=77, 67358777=99, 107722321=73, 3111266633=15, 2786463316=102, 3380282686=73, 87191924=78, 579340992=74, 1633543440=75, 100136358=98, 116716199=113, 19088758=15, 1243679597729910786=258, 2686834802=22, 14173315=130, 939091=98, 281452710=75, 1323730225067339784=100, 49384084=73, 105580076=98, 50393960=105, 2196203149=73, 612473=94, 545081356=78, 155203891=73, 49013407=113, 20457806=107, 1260305429135048705=466, 232268199=100, 811229675758505984=18, 197470016=83, 2827556878=466, 555370896=466, 302665348=466, 19491239=75, 44196397=4, 1089729658042699776=103, 16664681=98, 393637870=74, 17895820=75, 1053271640=73, 35463810=74, 77821953=11, 1179455215=73, 3363926051=82, 117022298=74, 23921102=98, 2353071330=466, 14281853=121, 120233868=133, 28300550=225, 15438913=77, 803694179079458816=111, 7587032=103, 3349925638=73, 2170986966=98, 38287098=98, 504934059=87, 89887215=111, 16017475=121, 807095=133, 2494186513=80, 207874268=98, 732868196261335040=402, 773177323352911872=73, 15157283=18, 2377589106=81, 482866177=3, 82320431=4, 1351307834965831680=225, 1222909149043924994=13, 16931273=166, 143212610=89, 4391165297=116, 224896427=84, 1369039188=419, 34020042=106, 1065372669934272513=442, 26969416=7, 438758130=74, 191862712=101, 522634225=85, 484821055=99, 231033118=22, 22799750=101, 19884529=73, 1158193640=6, 282914879=466, 289883555=434, 97219875=24, 586497561=79, 746371177174679552=466, 330717019=73, 351347712=466, 2383882980=47, 28838219=135, 54575030=96, 34247411=77, 2954167529=4, 337808606=114, 74444946=74, 2887077099=73, 34713362=100, 189868631=147, 1245699895=80, 1647291168=466, 62576309=91, 45010849=74, 1160150106018070528=466, 34116377=106, 66147040=76, 833150310524809216=16, 1976143068=153, 185790986=84, 4645237240=9, 144979390=83, 1213104217675616256=126, 1174254240337977345=16, 62465691=173, 92943533=8, 27013292=103, 4896117477=106, 55060090=202, 471741741=13, 27695248=80, 2979630241=5, 568143078=5, 1290722208910839809=466, 136004952=81, 6107422=79, 1017280993=4, 4010545737=2, 62123765=466, 462021312=111, 29193463=111, 707197958333337600=87, 1962626484=75, 941675887=76, 26876107=98, 1178622443814084608=3, 14529929=225, 20675681=466, 4898091=75, 2786994047=15, 19658826=76, 60606206=91, 309587728=11, 990720508550373376=10, 3362016513=75, 1256987273217953794=400, 36974428=74, 44763075=13, 371726146=24, 2849876151=76, 584554426=83, 2596143056=22, 16669075=111, 2913798339=86, 130197171=79, 41874178=101, 120184404=77, 364476474=419, 2173779986=75, 19424427=92, 19825835=121, 564511791=225, 32372834=134, 60483082=106, 16162149=225, 53963427=81, 753329253589090305=4, 87818409=75, 14157134=77, 14224719=85, 84684955=99, 368240745=86, 19740854=77, 19644592=75, 1216654609768484865=10, 32493647=80, 1338185260627075078=511, 547837199=98, 335537750=225, 9300262=98, 1016022128699891714=466, 2890801661=97, 1352962327=126, 2425571623=84, 748453510048518145=92, 1949420935=91, 971315817358020608=73, 15741261=75, 21201150=73, 79570177=103, 216739115=73, 2838333676=466, 25562183=5, 916305113630814213=466, 11695472=98, 3825968584=401, 2590932906=13, 631792749=404, 50689731=95, 15484198=466, 33933259=18, 3419251203=103, 3108351=80, 352410832=408, 4882743003=73, 255223525=466, 759251=101, 1106193729235402753=402, 19902709=6, 2918267949=466, 152656121=78, 111556423=77, 824761019591450625=98, 3727749075=12, 1222796311168077824=148, 20543696=73, 65375759=138, 1133048122702274560=83, 14159148=14, 2276726336=225, 902620050636595203=73, 61183568=6, 24378502=73, 18839785=12, 3899497877=8, 77732185=13, 1278401163373707267=103, 1268973561739436047=101, 500964316=101, 593289567=138, 757537572=466, 16638708=98, 20973388=77, 45586617=121, 855160404733042688=6, 173154368=73, 1330596491950497792=466, 157981564=79, 326184301=76, 551426814=127, 25702314=225, 2345299433=83, 403488296=73, 81424127=466, 172090468=73, 179887262=74, 83440337=107, 508081252=92, 835608547=73, 987288415858319360=4, 914281548=466, 380648579=3, 486441670=76, 32372694=466, 14291684=75, 138494590=225, 110437588=85, 80872081=127, 44783853=100, 331672974=76, 1463193979=82, 1146329871418843136=79, 146569971=121, 19701628=73, 234694571=93, 20970341=74, 162071541=102, 221485934=86, 352946007=77, 1244892413262311425=22, 21114659=42, 2969760609=74, 4160274844=106, 1031950356169809920=399, 1015196564690743296=75, 2231199386=466, 12588712=74, 16683666=79, 158426909=98, 2194905277=23, 864560037821370369=108, 46477493=225, 424478521=422, 95022046=80, 1005085697018138624=148, 2999447739=77, 400181671=225, 806344552718045184=10, 160952087=96, 20543416=89, 573803698=5, 35315865=149, 24516595=75, 1059555794188939275=466, 1019887446417215489=12, 1879577221=4, 959074945144967169=124, 2365875094=402, 2311193425=225, 1480749782=76, 2227355222=147, 102658187=134, 1489776218=120, 33934492=98, 26559241=98, 25049056=73, 1284146730=8, 5026541=76, 1108842183036157952=466, 24869853=466, 4219463128=5, 244701234=225, 1351231556753510415=115, 1459872168=419, 3007452653=413, 54506896=80, 1108477440517656576=92, 2905276319=80, 14700117=84, 766179072519069696=75, 18247597=98, 18856867=4, 1377674285557370883=9, 174151902=78, 3390960802=73, 33235771=73, 171876607=97, 70664947=466, 18549724=6, 24263=225, 40156330=136, 170252522=8, 19058678=94, 860123351154556928=103, 941550142217261056=148, 21419935=98, 1944466748=75, 539431677=416, 917416223541022720=73, 1086322031141027840=466, 19017675=73, 69732035=438, 1380122249030684674=73, 17746914=130, 1063583406196445184=74, 20098015=3, 1094762324097822720=104, 77196907=399, 158021529=466, 794610090=4, 28785486=77, 5120691=16, 4515563482=100, 557943742=82, 1293763309934645250=15, 769802145726132224=416, 66673916=73, 219275799=74, 278656915=466, 774510439824822273=74, 856010760=73, 2985479932=106, 15082486=74, 1349149096909668363=111, 1214108358292041728=77, 159454866=74, 17483289=74, 136198923=13, 16973333=75, 14085070=117, 857193486=402, 39743812=103, 260502681=225, 52548608=79, 141141836=466, 56488059=142, 1035418272764715008=243, 459390022=466, 14499829=124, 18831926=225, 91334232=74, 11744152=225, 598271129=80, 519813577=3, 86626845=139, 7349062=419, 159992511=83, 15346653=225, 112398730=6, 61987976=75, 267283669=466, 299273962=90, 166426325=81, 1267767504=98, 1256925276530974721=86, 22703645=11, 8170292=76, 17393219=129, 15974328=89, 309128487=101, 15393700=103, 1238949674989416449=148, 23056912=6, 1435461=77, 46650770=81, 952885954657816576=466, 335312037=89, 298734224=81, 16343974=96, 1058805479168712705=9, 34655603=21, 87429715=4, 1276595984798187521=258, 1264159600858857472=73, 350782341=5, 200434844=148, 380285402=76, 23424533=91, 514623965=4, 1731805261=225, 1255393579507351554=136, 143415291=134, 1029760158115590145=98, 34264439=73, 22031058=73, 852538501832769540=74, 121127090=103, 921818491=403, 3140868280=466, 8973062=81, 818930496=99, 159093485=400, 41822696=81, 728654121205641216=73, 143629076=73, 174263807=127, 1060578475=74, 471287735=73, 216299334=89, 1728485538=73, 5402612=79, 834033651578978304=206, 115494227=80, 3391985055=466, 10215212=127, 362144301=73, 15687507=94, 884278026191552512=4, 26642006=103, 595174584=75, 39416218=138, 394087611=143, 3832681397=407, 38349184=98, 956610254=16, 23829152=399, 769634997682655236=77, 310746442=74, 728039605=419, 1351284403801108481=115, 1466783923=5, 30354991=103, 66493463=166, 365037094=83, 20498140=75, 47678782=117, 2467791=105, 16936686=10, 621543=80, 2836421=129, 255147207=76, 776012214=7, 289511094=414, 381592902=111, 1104175997333708800=466, 1972925030=398}
        //{500964316=100, 453473029=74, 593289567=123, 757537572=322, 2659372678=172, 286432534=98, 23185764=322, 4906451067=109, 923719833077846021=27, 755135678422327296=262, 20973388=76, 820452522494226433=138, 45586617=106, 450896622=80, 19397942=86, 855160404733042688=5, 1056850669=17, 22146373=5, 2790295109=5, 1330596491950497792=322, 157981564=78, 704282873231237121=129, 326184301=75, 730526974003838976=322, 17836302=77, 551426814=126, 25702314=172, 2345299433=81, 1194962714=125, 1253665449008562178=101, 81424127=322, 508081252=86, 21707108=322, 594508639=5, 14050532=23, 914281548=322, 522487569=4, 3131144855=92, 87679233=112, 406842374=111, 32372694=322, 3111266633=8, 14291684=74, 138494590=172, 110437588=81, 2786463316=102, 80872081=126, 3380282686=73, 44783853=99, 331672974=75, 1463193979=80, 1146329871418843136=79, 146569971=121, 19088758=14, 234694571=87, 1243679597729910786=190, 2686834802=17, 14173315=129, 221485934=83, 352946007=75, 1244892413262311425=17, 281452710=74, 21114659=27, 4160274844=98, 1031950356169809920=255, 1015196564690743296=73, 2231199386=322, 12588712=73, 2194905277=18, 864560037821370369=100, 612473=90, 46477493=172, 545081356=77, 424478521=266, 49013407=107, 95022046=80, 1260305429135048705=322, 1005085697018138624=131, 2999447739=76, 400181671=172, 20543416=83, 35315865=132, 2827556878=322, 1059555794188939275=322, 555370896=322, 959074945144967169=124, 302665348=322, 19491239=75, 1089729658042699776=103, 2365875094=256, 2311193425=172, 1489776218=106, 16664681=98, 1284146730=5, 5026541=75, 77821953=9, 1108842183036157952=322, 3363926051=80, 117022298=73, 2353071330=322, 14281853=118, 24869853=322, 4219463128=3, 244701234=172, 28300550=172, 1351231556753510415=112, 15438913=76, 7587032=99, 1459872168=269, 3007452653=266, 54506896=80, 1108477440517656576=87, 2170986966=88, 504934059=83, 2905276319=79, 14700117=80, 16017475=106, 766179072519069696=75, 807095=132, 2494186513=78, 174151902=77, 732868196261335040=255, 171876607=94, 15157283=12, 70664947=322, 2377589106=81, 1351307834965831680=172, 24263=172, 1222909149043924994=9, 16931273=141, 143212610=83, 4391165297=102, 224896427=83, 1369039188=269, 40156330=131, 1065372669934272513=281, 26969416=7, 438758130=73, 19058678=88, 191862712=100, 522634225=81, 941550142217261056=132, 539431677=266, 231033118=17, 282914879=322, 289883555=276, 1086322031141027840=322, 97219875=16, 19017675=73, 69732035=278, 746371177174679552=322, 1094762324097822720=95, 351347712=322, 77196907=253, 158021529=322, 2383882980=34, 28838219=132, 794610090=3, 54575030=87, 34247411=75, 28785486=77, 337808606=112, 5120691=14, 74444946=73, 557943742=80, 1293763309934645250=10, 769802145726132224=265, 34713362=98, 189868631=146, 278656915=322, 1245699895=77, 774510439824822273=73, 1647291168=322, 62576309=85, 45010849=74, 1160150106018070528=322, 15082486=74, 833150310524809216=11, 1214108358292041728=75, 136198923=9, 16973333=74, 185790986=81, 14085070=113, 857193486=258, 4645237240=6, 144979390=79, 1213104217675616256=109, 1174254240337977345=14, 260502681=172, 141141836=322, 56488059=142, 1035418272764715008=179, 459390022=322, 14499829=123, 18831926=172, 11744152=172, 4896117477=98, 598271129=77, 55060090=149, 86626845=136, 7349062=266, 159992511=80, 15346653=172, 267283669=322, 568143078=3, 1290722208910839809=322, 299273962=80, 166426325=78, 6107422=78, 62123765=322, 1256925276530974721=82, 462021312=111, 29193463=107, 17393219=121, 15974328=82, 309128487=100, 707197958333337600=82, 1238949674989416449=132, 941675887=75, 14529929=172, 952885954657816576=322, 335312037=82, 20675681=322, 298734224=79, 16343974=96, 1058805479168712705=7, 2786994047=10, 60606206=86, 309587728=8, 34655603=15, 3362016513=75, 1256987273217953794=255, 1276595984798187521=190, 1264159600858857472=73, 371726146=19, 2849876151=74, 2596143056=17, 16669075=111, 200434844=132, 23424533=86, 514623965=2, 1731805261=172, 1255393579507351554=132, 41874178=100, 120184404=76, 364476474=266, 19424427=87, 19825835=118, 852538501832769540=74, 121127090=98, 921818491=258, 564511791=172, 3140868280=322, 8973062=79, 818930496=98, 60483082=106, 16162149=172, 53963427=81, 753329253589090305=3, 14157134=76, 159093485=255, 14224719=82, 41822696=80, 368240745=83, 19740854=76, 19644592=73, 174263807=126, 1060578475=73, 32493647=79, 1338185260627075078=327, 335537750=172, 834033651578978304=153, 115494227=76, 3391985055=322, 1016022128699891714=322, 2890801661=94, 1352962327=119, 2425571623=83, 748453510048518145=87, 1949420935=86, 10215212=126, 15687507=90, 15741261=75, 79570177=103, 2838333676=322, 916305113630814213=322, 3825968584=256, 39416218=134, 2590932906=12, 631792749=258, 394087611=136, 3832681397=259, 38349184=98, 956610254=11, 15484198=322, 23829152=255, 769634997682655236=75, 33933259=17, 3419251203=102, 728039605=269, 352410832=259, 255223525=322, 1351284403801108481=112, 759251=100, 1106193729235402753=258, 2918267949=322, 152656121=78, 111556423=76, 66493463=141, 824761019591450625=98, 3727749075=8, 365037094=79, 1222796311168077824=132, 47678782=111, 65375759=134, 16936686=10, 1133048122702274560=80, 2836421=128, 2276726336=172, 776012214=5, 289511094=262, 381592902=107, 77732185=12, 1104175997333708800=322, 1278401163373707267=95, 1972925030=254, 1268973561739436047=100}


        //System.out.println(rank.LPA(graph3.adj));
    }

}
